{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": "container",
   "height": "container",
  "title": {
    "text": "Breakdown of Greenhouse Gas Emissions by State and Sector (2023)",
    "subtitle": "Hover for details or filter by sector (Mt COâ‚‚-e)",
    "anchor": "start"
  },
  "data": {
    "url": "bushfire/data/Emissions_by_state_and_territory.csv"
  },
  "transform": [
    { "filter": "datum.Year == 2023" },
    {
      "calculate": "max(0, datum.Energy_Mt)",
      "as": "Energy_Mt"
    },
    {
      "calculate": "max(0, datum.Industrial_Mt)",
      "as": "Industrial_Mt"
    },
    {
      "calculate": "max(0, datum.Agriculture_Mt)",
      "as": "Agriculture_Mt"
    },
    {
      "calculate": "max(0, datum.LandUse_Mt)",
      "as": "LandUse_Mt"
    },
    {
      "calculate": "max(0, datum.Waste_Mt)",
      "as": "Waste_Mt"
    },
    {
      "fold": [
        "Energy_Mt",
        "Industrial_Mt",
        "Agriculture_Mt",
        "LandUse_Mt",
        "Waste_Mt"
      ],
      "as": ["Sector", "Emissions_Mt"]
    }
  ],
  "params": [
    {
      "name": "sector_filter",
      "select": { "type": "point", "fields": ["Sector"] },
      "bind": {
        "input": "select",
        "options": [
          null,
          "Energy_Mt",
          "Industrial_Mt",
          "Agriculture_Mt",
          "LandUse_Mt",
          "Waste_Mt"
        ],
        "labels": [
          "Show All Sectors",
          "Energy",
          "Industrial",
          "Agriculture",
          "Land Use",
          "Waste"
        ],
        "name": "Filter by Sector: "
      }
    }
  ],
  "mark": { "type": "bar" },
  "encoding": {
    "y": {
      "field": "State",
      "type": "nominal",
      "title": "State / Territory",
      "sort": "-x"
    },
    "x": {
      "aggregate": "sum",
      "field": "Emissions_Mt",
      "type": "quantitative",
      "stack": "normalize",
      "title": "Proportion of Total Emissions"
    },
    "color": {
      "field": "Sector",
      "type": "nominal",
      "title": "Emission Source",
      "scale": {
        "range": ["#7f2704", "#a63603", "#d94801", "#f16913", "#fdae6b"]
      }
    },
    "tooltip": [
      { "field": "State", "title": "State" },
      { "field": "Sector", "title": "Sector" },
      {
        "aggregate": "sum",
        "field": "Emissions_Mt",
        "type": "quantitative",
        "format": ".2f",
        "title": "Emissions (Mt COâ‚‚-e)"
      }
    ],
    "opacity": {
      "condition": { "param": "sector_filter", "value": 1 },
      "value": 0.5
    }
  },
  "config": {
    "view": { "stroke": "transparent" },
    "axis": { "labelFontSize": 11, "titleFontSize": 12 },
    "legend": { "titleFontSize": 12, "labelFontSize": 11 }
  }
}


